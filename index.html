<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="referrer" content="no-referrer">
	<link rel="icon" href="assets/img/logo.webp" type="image/*" />
	<link href="assets/css/style.css" rel="stylesheet" type="text/css">
	<link href="assets/css/APlayer.min.css" rel="stylesheet" type="text/css">
	<link href="assets/css/highlight.github.min.css" rel="stylesheet" type="text/css">
	<link href="assets/css/custom.css" rel="stylesheet" type="text/css">
	<title>Memos Top - DayDayUp</title>
</head>

<body>
	<header>
		<div class="menu">
			<div class="title">DayDayUp</div>
			<div class="pages">
					<a href="https://github.com/wahaha1024/memos.top" target="_blank" rel="noopener noreferrer">GitHub</a>
					<a href="https://mm.zjyyy.top/" target="_blank" rel="noopener noreferrer">Memos</a>
			</div>
		</div>
		<div class='theme-toggle'>ğŸŒ“</div>
	</header>

	<section id="main" class="container">
		<h1>Memos Top</h1>
		<blockquote style="margin-bottom: 20px;">
			<p>Je <del>memos</del>, donc je suis - <em>RenÃ© Descartes fans</em></p>
		</blockquote>

		<div class="total">Total <span id="total">0</span> Memos ğŸ‰</div>

		<div id="memos" class="memos">
			<div style="text-align:center; padding: 20px;">å†…å®¹åŠ è½½ä¸­...</div>
		</div>
	</section>

	<footer class="markdown-body footer">
		<p>Copyright @ <script>document.write(new Date().getFullYear())</script> <a href="#">DayDayUp</a>. All Rights Reserved.</p>
	</footer>

	<script src="assets/js/marked.umd.min.js?v=14.0.0"></script>
	<script src="assets/js/view-image.min.js"></script>
	
	<script type="text/javascript">
		const memosConfig = {
			host: 'https://mmm.zjyyy.top',
			parent: 'users/1', // v0.24+ å¿…é¡»ä½¿ç”¨ parent
			pageSize: 10
		};

		async function loadMemos() {
			const container = document.getElementById('memos');
			const totalSpan = document.getElementById('total');
			// æ„é€  v0.24+ ä¸“ç”¨çš„ URL
			const url = `${memosConfig.host}/api/v1/memos?parent=${memosConfig.parent}&pageSize=${memosConfig.pageSize}`;

			try {
				const response = await fetch(url);
				if (!response.ok) throw new Error('API è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ' + response.status);
				
				const data = await response.json();
				const memos = data.memos || [];
				totalSpan.innerText = memos.length; // æ›´æ–°æ•°é‡

				if (memos.length === 0) {
					container.innerHTML = "æ²¡æœ‰å‘ç°å…¬å¼€çš„ Memosã€‚";
					return;
				}

				// æ¸²æŸ“åˆ—è¡¨
				container.innerHTML = memos.map(memo => {
					const time = new Date(memo.createTime).toLocaleString();
					// ä½¿ç”¨ marked å¤„ç†å†…å®¹ï¼ˆå¦‚æœæœ‰å¯¼å…¥çš„è¯ï¼‰
					const contentHtml = typeof marked !== 'undefined' ? marked.parse(memo.content) : memo.content;
					
					// ç®€å•å›¾ç‰‡æ¸²æŸ“é€»è¾‘
					let imgHtml = "";
					if (memo.resources) {
						imgHtml = memo.resources.map(res => 
							`<div class="res-img"><img src="${memosConfig.host}/file/${res.name}/${res.filename}" alt="res" onclick="window.ViewImage && ViewImage.display(this.src)"></div>`
						).join('');
					}

					return `
						<div class="memo-item" style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
							<div class="memo-content markdown-body">${contentHtml}</div>
							<div class="memo-res" style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">${imgHtml}</div>
							<div style="font-size: 12px; color: #888; margin-top: 10px;">${time}</div>
						</div>
					`;
				}).join('');

				// è¿™é‡Œçš„ä»£ç å¯ä»¥æ ¹æ®éœ€è¦æ‰‹åŠ¨åˆå§‹åŒ– ViewImage
				if (window.ViewImage) window.ViewImage.init('.res-img img');

			} catch (err) {
				console.error(err);
				container.innerHTML = `<div style="color:red; text-align:center;">åŠ è½½å‡ºé”™: ${err.message}<br>è¯·æ£€æŸ¥ Memos åå°çš„ CORS è®¾ç½®æ˜¯å¦åŒ…å«å½“å‰åŸŸåã€‚</div>`;
			}
		}

		// ä¸»é¢˜åˆ‡æ¢ç®€å•é€»è¾‘
		document.querySelector('.theme-toggle').addEventListener('click', () => {
			document.body.classList.toggle('dark-mode');
		});

		window.onload = loadMemos;
	</script>

	<script src="assets/js/APlayer.min.js"></script>
	<script src="assets/js/Meting.min.js"></script>
</body>
</html>
